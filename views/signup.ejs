<% layout("/layouts/boilerplate") %> <br /><br />

<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  rel="stylesheet"
/>

<style>
  /* === Background Styles === */
  body {
    background: url("/background.png") no-repeat center center fixed;
    background-size: cover;
    min-height: 100vh;
    position: relative;
  }

  body::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.45);
    z-index: 0;
  }

  /* === Container Styles === */
  .signup-wrapper {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 90vh;
    padding: 2rem 1rem;
  }

  .form_body {
    background-color: rgba(255, 255, 255, 0.92);
    border-radius: 10px;
    padding: 30px;
    width: 100%;
    max-width: 420px;
    box-shadow: 0 7px 15px rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(5px);
  }

  .signup_form input[type="text"],
  .signup_form input[type="email"],
  .signup_form input[type="password"] {
    border-radius: 5px;
    padding: 12px;
    width: 100%;
    margin-top: 10px;
  }

  .password-box {
    position: relative;
  }
  .password-box input.form-control {
    padding-right: 45px !important;
  }
  .password-box i {
    position: absolute;
    right: 15px;
    top: 58%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #555;
    font-size: 18px;
    z-index: 2;
  }
</style>

<div class="signup-wrapper">
  <div class="form_body">
    <form
      method="POST"
      action="/signup"
      class="needs-validation"
      id="signupForm"
      novalidate
    >
      <h2 class="text-center mb-4">Create Account</h2>

      <div class="mb-3 signup_form">
        <label for="username" class="form-label">Username</label>
        <input
          type="text"
          name="username"
          placeholder="Username"
          class="form-control"
          required
        />
      </div>
      <div class="mb-3 signup_form">
        <label for="email" class="form-label">Email Id</label>
        <input
          type="email"
          name="email"
          placeholder="Email"
          class="form-control"
          required
        />
      </div>

      <div class="mb-3 signup_form">
        <label for="password" class="form-label">Password</label>
        <div class="password-box">
          <input
            type="password"
            name="password"
            id="signup-password"
            placeholder="Password"
            class="form-control"
            required
          />
          <i id="signup-togglePassword" class="fa-solid fa-eye"></i>
        </div>
      </div>

      <div class="mb-3 signup_form">
        <label for="cnfPassword" class="form-label">Confirm Password</label>
        <div class="password-box">
          <input
            type="password"
            name="cnfPassword"
            id="cnfPassword"
            placeholder="Confirm Password"
            class="form-control"
            required
          />
          <i id="toggleCnfPassword" class="fa-solid fa-eye"></i>
        </div>
      </div>

      <div class="d-grid gap-2 mt-3">
        <button class="btn btn-danger" name="saveButton" type="submit">
          Sign up
        </button>
      </div>
      <div class="mt-3 text-center navigatee">
        Already have an account? <a href="/login">Login</a>
      </div>
    </form>
  </div>
</div>

<script>
  // === Bootstrap form validation ===
  (function () {
    "use strict";
    const forms = document.querySelectorAll(".needs-validation");
    Array.from(forms).forEach(function (form) {
      form.addEventListener(
        "submit",
        function (event) {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add("was-validated");
        },
        false
      );
    });
  })();

  // === FINAL Corrected Password Toggler Script ===
  document.addEventListener("DOMContentLoaded", function () {
    // --- Setup for the MAIN password field ---
    const togglePassword = document.getElementById("signup-togglePassword");
    // CHANGE #2: Looking for the new unique INPUT ID
    const passwordInput = document.getElementById("signup-password");

    if (togglePassword && passwordInput) {
      togglePassword.addEventListener("click", function () {
        const isPassword = passwordInput.type === "password";
        passwordInput.type = isPassword ? "text" : "password";
        this.classList.toggle("fa-eye");
        this.classList.toggle("fa-eye-slash");
      });
    }

    // --- Setup for the CONFIRM password field ---
    const toggleCnfPassword = document.getElementById("toggleCnfPassword");
    const cnfPasswordInput = document.getElementById("cnfPassword");

    if (toggleCnfPassword && cnfPasswordInput) {
      toggleCnfPassword.addEventListener("click", function () {
        const isPassword = cnfPasswordInput.type === "password";
        cnfPasswordInput.type = isPassword ? "text" : "password";
        this.classList.toggle("fa-eye");
        this.classList.toggle("fa-eye-slash");
      });
    }
  });
</script>
